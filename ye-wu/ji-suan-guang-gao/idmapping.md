# IDMapping

APP市场越来越大，现代人手机里也装载了越来越多的APP。日常被频繁使用。比如你可能装了微信，QQ，淘宝，手机百度。而现在上网设备也越来越丰富，除了电脑，手机，还有平板电脑，甚至智能电视等多种设备形式。上一小时我打了一局英雄联盟，下一小时我在iPad上看云南虫谷，晚上我想在手机上看头条新闻，或者刷会抖音。。。我换了很多的设备，产生很多上网时长。然而其实这些都是我在产生的流量。

**标识并认出来使用这些设备的，产生这些行为的都是同一个人，是个很有意义的事情。**我在电脑上搜了健身装备，然后我在手机上刷出广告，如果一个广告是母婴用品，一个广告是健身装备，直观上来看我会对健身装备的广告更感兴趣，更容易产生点击，购买等行为。怎么样才能知道用这些设备，使用这些app的都是一个人呢？**这就是IDMapping**。

一种非常像IDMapping的技术，就是账号体系。以腾讯为例，你在电脑上玩英雄联盟，在平板电脑上看QQ视频，在手机上听QQ音乐，你都可以用QQ号（或者微信）登录，来表示这些都是同一个用户。不过这也相对有一些局限性：除非你使用的APP都是腾讯（或所属）公司所有的，否则无法用QQ号登录，那也就无法标识了。比如平板上用的是爱奇艺视频，或者手机上用网易云音乐，那么（对于腾讯来说）就无法认出此时这个用户是你了。

另一种方法，就是建立一个比账户体系更大范围的ID体系。以阿里系为例，优酷，高德，淘宝都属于阿里系公司，然而每一个APP都有自己的账户体系，很明显对于淘宝，他无法识别优酷账户ID代表的是谁；对于高德来说，他也无法识别淘宝userID意味着什么。但是由于他们都属于阿里系旗下公司，**三者可能都使用的相同的手机号进行绑定，又或者可能装载在同一设备上，通过离线的关系挖掘，便可能让我们知道这是同一个人。**

> 比如用户在手机A上装过淘宝和高德，在平板电脑B上装过淘宝和优酷，那么通过手机A的设备号，使得淘宝userID跟高德userID产生关联；又通过平板电脑B的设备号，使得淘宝userID和优酷userID产生了关联，间接使得这个用户的高德userID和优酷userID形成了关联，又因为使用的相同的淘宝userID，使得手机A和平板电脑B也产生了关联关系...

**通过手机号，邮箱，设备ID等信息关联，使得本来不互通的账户，设备等形成了关联关系，能够标识同一个用户，这就是IDMapping的作用。**

通过上面的描述，我们大概可以了解到IDMapping的大致过程：

1. **通过强关系得到一系列的pair对**：强关系比如用户的账户ID绑定的手机号，邮箱，或者你在注册账户时候要求强绑定的另一个账户（比如你可能遇到过注册新账户时候要求绑定了支付宝账户）等；这个pair就可以是 {账户ID，手机号}，或者 {账户ID1，账户ID2} 这种；
2. **通过弱关系得到一系列的pair对**：弱关系比如上面提到的，用户在手机上装过淘宝和高德，在平板上装过淘宝和优酷；更弱的关系比如在电脑上使用淘宝，产出cookie等。。。弱关系的pair对也类似上一步，得到 {账户ID，设备} , 或者 {账户ID，cookie} 等pair对。这里的pair里的组成不局限于账户ID，设备等等，只是关联关系的表达。只要是有用的关联关系，都可以形成pair对；
3. **将这些pair对集合串联起来，形成一条链，这个链是所有通过上述pair对产生了直接或间接关系的集合**：比如上述提到的例子，{淘宝userID，高德userID，优酷userID，手机A，平板电脑B} 这就是一系列集合，因为这些都是同一个用户使用的集合；
4. **为上述的集合分配一个唯一ID，形成KV表，变成IDMapping**：为上面提到的这个集合分配唯一ID，这样这个集合之间变通过这个唯一ID形成连接，可以互相查询。比如上面的例子，可以用淘宝userID查到用户使用的设备都有哪些，或者该用户的高德userID是多少，等等。

明显除了强关系外，弱关系是个很容易发生变化的关系，那么集合也相对应内容会发生变化。举例比如男生A我的平板电脑登录过优酷。后来这个平板电脑卖给了一个女生B，她也登录了优酷，此时应该把这个平板电脑的ID从男生A的集合中剔除，移动到女生B的集合中。**IDMapping肯定不是一劳永逸的，即这个集合肯定不是一成不变的。越快能感知到这个变化并重新计算，便越有利于IDMapping最大化它的作用。**

按上述所说，我们得到这个IDMapping以后，都能用它来干什么呢？举例：

1. 比如我希望做用户增长，就希望知道用户在外部APP上的画像是什么。如何通过我手里现有的用户ID获得外部画像或者标签？
2. 媒体希望卖出流量实现商业化，广告主希望采买流量来实现营销。现在媒体的流量提供给广告主，广告主如何识别这些流量，哪些是想要的，哪些是不想要的？

结合这些，想必你便能够清楚，为什么你在打开抖音，知乎，微博，也能够推送你感兴趣的淘宝，京东广告了吧！

**IDMapping是全域营销中非常重要的一个概念。它能够提供的数据互通能力对于广告投放来说是意义非凡的。**它并不是一个互联网上的一种标准，每个互联网公司都可以建设自己的IDMapping体系。当然自建IDMapping体系对于各个公司的价值就不一定了。对于小公司，如果希望能接入或者使用IDMapping的体系，市面上也有类似第三方公司，典型的就是友盟+。

而IDMapping中主key的生成，也就是上面提到的这个唯一ID，参考分布式自增ID的实现原理。目前被工业化普及的最典型的技术，就是twitter的雪花算法。

在互联网监管越来越严厉的大背景下，用户隐私被越来越重视。用户的麦克风权限，摄像头权限，地理位置权限，设备号信息等，都被定义为用户隐私范畴，也已经出台相关条例要明令禁止APP未经过用户允许的条件下私自获取用户隐私信息。移动互联网的时代，设备号对于产出上述pair对是非常重要的存在，即对IDMapping有着举足轻重的意义。在这样的隐私政策下，IDMapping的未来发展前途越来越不明朗，而强健的账户体系却逐渐表现出优势。同样的，未来用户的运营，流量的增长与维持，会发展成什么形态，也是个值得期待的事情。



参考：

{% embed url="https://zhuanlan.zhihu.com/p/113173492" %}

{% embed url="https://toutiao.io/posts/hh9t7ok/preview" %}
